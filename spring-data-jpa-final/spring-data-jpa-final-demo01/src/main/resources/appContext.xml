<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans.xsd
                http://www.springframework.org/schema/context
                http://www.springframework.org/schema/context/spring-context.xsd
        	    http://www.springframework.org/schema/data/jpa
        	    http://www.springframework.org/schema/data/jpa/spring-jpa.xsd">

    <!--
        实体管理器工厂: id 必须为 entityManagerFactory
         数据库连接池
         实体类所在的包
         jpa 实现方
         jpa 适配器
         jpa 方言
    -->
    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"
          p:dataSource-ref="dataSource"
          p:packagesToScan="org.anonymous.domain"
          p:persistenceProvider-ref="persistenceProvider"
          p:jpaVendorAdapter-ref="jpaVendorAdapter"
          p:jpaDialect-ref="jpaDialect"/>

    <!--jpa 实现方-->
    <bean id="persistenceProvider" class="org.hibernate.jpa.HibernatePersistenceProvider"/>

    <!--jpa供应商适配器-->
    <bean id="jpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"
          p:database="MYSQL" p:databasePlatform="org.hibernate.dialect.MySQL8Dialect"
          p:showSql="true" p:generateDdl="true"/>

    <!--jpa方言: 高级特性-->
    <bean id="jpaDialect" class="org.springframework.orm.jpa.vendor.HibernateJpaDialect"/>


    <!--jdbc.properties-->
    <context:property-placeholder location="classpath:jdbc.properties"/>
    <!--dataSource-->
    <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"
          p:driverClassName="${jdbc.driver}" p:url="${jdbc.url}"
          p:username="${jdbc.username}" p:password="${jdbc.password}"/>

    <!--mapper: 相当于 ioc: 创建代理对象-->
    <jpa:repositories base-package="org.anonymous.dao" transaction-manager-ref="transactionManager"/>

    <!--tx-->
    <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager"
          p:entityManagerFactory-ref="entityManagerFactory"/>

    <!--ioc: 可以不加, dao 有自己的 注解扫描: jpa:repository-->
    <!--<context:component-scan base-package="org.anonymous"/>-->
</beans>